# STEP 3-2
==========

shortenUrl 채번 규칙에 제한을 두고 싶어요.
-------------

***

## 목차🧭

- [개요](#개요)
- [배경](#배경)
- [목표](#목표)
- [목표가 아닌 것](#목표가-아닌-것)
***

## 개요📜

>운영환경 정보를 서브도메인을 통해 표현할 수 있도록 합니다.

***   

## 배경🖼️

>요청하는 서비스의 환경정보를 알 수 없는 불편함이 있습니다.
***

## 목표📌

1. 각 환경을 서브도메인을 통해 표현할 수 있도록 합니다.
***

## 목표가 아닌 것✂️

- 코드 작업
***

## 질문 사항🧑‍💻
1. key 에 대해 prefix 를 추가하는 이유
    - 환경별로 독립된 db 를 사용할 수 없다는 제약이 있는건가요?


2. prefix 추가로 인한 url 가독성 저하 문제
   - 현재 key 로 shorten-url 을 이용하고 있습니다.
   - prefix 추가 시 사용자 경험에 부정적 영향을 줄 것으로 예상합니다.
   - 반드시 구현되어야 하는 기능이라면 composite key 를 활용하는 방식은 어떨까요?

   
3. 정말 구현이 필요한 기능인가요?  
   `현재 dev, stg, prd 는 개별적으로 운영 중인 상황을 가정합니다.`
   - 우리 서비스는 환경별로 독립적으로 운영되므로, 데이터 역시 분리되어 있습니다.
   - 개발 환경과 운영 환경의 데이터가 하나의 DB에 공존하는 것은 매우 위험해 보입니다.
   - 이 기능의 구현 목적이 환경 간 데이터가 혼재될 가능성을 가정한 것이라면,
   - 과연 이 기능이 실제로 필요한지 다시 검토해볼 필요가 있습니다.

## 답변🧑‍💻
>기획자) composite key 가 뭐죠?
>- 부정적으로 보일 것이라는 근거는 무엇인가요?
>- composite key 도 뭔지 모르겠어요.
>- 예시가 있어야 좀 더 얘기할 수 있을 것 같아요.
1. prefix 추가 시 가독성 저하 문제
   현재 단축 url 은 {도메인}/{key} 형태입니다. 이 때 prefix 가 추가되는 경우
    - 기존: https://domain/Ap9D74E
    - 변경 후: https://domain/devAp9D74E

- 이처럼 url 의 길이가 prefix 만큼 늘어나게 됩니다.
- 내부적으로 관리되어야 할 환경 정보가 노출 될 필요가 있을까요?
- `end-user` 에게도 노출될 수 있습니다.
----
2. composite key
   둘 이상의 값을 조합하여 고유성을 보장하는 방식입니다.
   {key}와 {environment} 를 이용하여 동일한 key 여도 환경에 따라 존재할 수 있게 됩니다.

- 예를 들면, 아래 테이블처럼 데이터를 저장할 수 있습니다.

| 단축 url (key) | 환경 정보 | 원본 url |
|:----|:---------|:---------|
| Ap9D74E | dev| https://google.com |
| Ap9D74E | stg | https://naver.com |
| Ap9D74E | prd | https://daum.net |

- 이렇게 하면 `Ap9D74E` 라는 키가 여러 환경에서 동일하게 존재할 수 있습니다.
- client 는 기존처럼 https://domain/abc1234 형태로 사용할 수 있고, 내부적으로만 환경값을 관리하면 됩니다.
